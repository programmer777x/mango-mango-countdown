<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthesized Timer Alarm</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
    <!-- Load Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <div id="timer-card" class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-lg text-center transform transition-all duration-300">
        <h1 class="text-4xl font-extrabold text-indigo-700 mb-6 tracking-tight">Focus Timer</h1>

        <!-- Timer Display -->
        <div class="text-7xl font-mono font-bold text-gray-900 mb-8 p-4 bg-indigo-50 rounded-xl shadow-inner">
            <span id="display-minutes">00</span>:<span id="display-seconds">00</span>
        </div>

        <!-- Input and Controls -->
        <div class="space-y-4">
            <div class="flex space-x-4">
                <input type="number" id="minutes-input" value="1" min="1" max="60"
                       class="flex-1 p-3 border-2 border-indigo-200 rounded-lg text-lg text-center focus:outline-none focus:border-indigo-500 transition duration-150"
                       placeholder="Minutes">
                <input type="number" id="seconds-input" value="0" min="0" max="59"
                       class="flex-1 p-3 border-2 border-indigo-200 rounded-lg text-lg text-center focus:outline-none focus:border-indigo-500 transition duration-150"
                       placeholder="Seconds">
            </div>

            <div class="flex space-x-3">
                <button id="start-button"
                        class="flex-1 py-3 px-6 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.01] disabled:opacity-50">
                    Start Timer
                </button>
                <button id="reset-button"
                        class="py-3 px-6 bg-gray-300 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-400 transition duration-150 transform hover:scale-[1.01]">
                    Reset
                </button>
            </div>
        </div>
        
        <!-- Status Message -->
        <div id="status-message" class="mt-6 text-sm text-gray-600 h-5"></div>

        <!-- Custom Modal for Alert -->
        <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center w-full max-w-sm">
                <h3 class="text-2xl font-bold text-red-600 mb-4">Time's Up!</h3>
                <p id="modal-text" class="text-lg text-gray-700 mb-6">Your synthesized alarm is playing!</p>
                <button id="modal-close-button" class="py-2 px-6 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150">
                    Stop & Close
                </button>
            </div>
        </div>
    </div>

    <script>
        const displayMinutes = document.getElementById('display-minutes');
        const displaySeconds = document.getElementById('display-seconds');
        const minutesInput = document.getElementById('minutes-input');
        const secondsInput = document.getElementById('seconds-input');
        const startButton = document.getElementById('start-button');
        const resetButton = document.getElementById('reset-button');
        const statusMessage = document.getElementById('status-message');
        const modal = document.getElementById('modal');
        const modalCloseButton = document.getElementById('modal-close-button');

        let intervalId = null;
        let totalSeconds = 0;
        let isRunning = false;
        let synth = null; // Tone.js Synth instance
        let feedbackDelay = null; // Tone.js Delay instance for the chime effect

        // --- Tone.js Setup ---
        function setupAudio() {
            // A simple synth (sine wave for clean tone)
            synth = new Tone.Synth({
                oscillator: { type: "sine" },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0.1, release: 0.5 },
            }).toDestination();

            // Add a slight delay/reverb effect for a "chime" sound
            feedbackDelay = new Tone.FeedbackDelay("8n", 0.5).toDestination();
            
            // Connect synth to the delay and then to the main output
            synth.connect(feedbackDelay);
        }
        
        // This function plays the sound
        function playAlarm() {
            // First, ensure audio context is running (required for browser security)
            if (Tone.context.state !== 'running') {
                Tone.start();
                statusMessage.textContent = "Audio context started!";
            }
            
            // Play a simple musical pattern (like a high-pitched C major triad)
            const now = Tone.now();
            
            synth.triggerAttackRelease("C5", "8n", now);
            synth.triggerAttackRelease("E5", "8n", now + 0.15);
            synth.triggerAttackRelease("G5", "4n", now + 0.3);
        }

        // This function stops the sound
        function stopAlarm() {
            // You can stop the sound by releasing all active notes
            synth.releaseAll();
        }

        // Initialize audio on load
        setupAudio();


        function updateDisplay() {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            displayMinutes.textContent = String(minutes).padStart(2, '0');
            displaySeconds.textContent = String(seconds).padStart(2, '0');
        }

        function startTimer() {
            if (isRunning) return;

            const inputMinutes = parseInt(minutesInput.value) || 0;
            const inputSeconds = parseInt(secondsInput.value) || 0;
            
            const initialSeconds = (inputMinutes * 60) + inputSeconds;

            if (initialSeconds <= 0) {
                statusMessage.textContent = "Please set a time greater than zero.";
                return;
            }

            totalSeconds = initialSeconds;
            updateDisplay();

            isRunning = true;
            startButton.textContent = 'Pause';
            statusMessage.textContent = 'Timer running...';
            
            // Disable inputs while running
            minutesInput.disabled = true;
            secondsInput.disabled = true;

            intervalId = setInterval(() => {
                totalSeconds--;
                updateDisplay();

                if (totalSeconds <= 0) {
                    clearInterval(intervalId);
                    isRunning = false;
                    startButton.textContent = 'Start Timer';
                    statusMessage.textContent = 'Time completed!';
                    
                    // --- Alarm Trigger ---
                    playAlarm();
                    
                    // Show custom modal
                    modal.classList.remove('hidden');
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!isRunning) return;
            clearInterval(intervalId);
            isRunning = false;
            startButton.textContent = 'Resume';
            statusMessage.textContent = 'Timer paused.';
        }

        function resumeTimer() {
            startTimer(); // The startTimer function handles resuming logic since totalSeconds is preserved
        }

        function resetTimer() {
            clearInterval(intervalId);
            totalSeconds = 0;
            isRunning = false;
            startButton.textContent = 'Start Timer';
            statusMessage.textContent = 'Ready to set time.';
            
            // Re-enable inputs
            minutesInput.disabled = false;
            secondsInput.disabled = false;

            // Reset inputs to default 1:00
            minutesInput.value = 1;
            secondsInput.value = 0;
            
            updateDisplay();
        }

        // Event Listeners
        startButton.addEventListener('click', () => {
            if (isRunning) {
                pauseTimer();
            } else if (totalSeconds > 0) {
                resumeTimer();
            } else {
                startTimer();
            }
        });

        resetButton.addEventListener('click', resetTimer);

        modalCloseButton.addEventListener('click', () => {
            stopAlarm();
            modal.classList.add('hidden');
        });

        // Initialize display
        resetTimer();
    </script>
</body>
</html>
